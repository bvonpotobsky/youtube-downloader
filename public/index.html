<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <title>yt video downloader</title>

    <style>
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: inherit;
      }

      html {
        box-sizing: border-box;
        font-size: 62.5%;
      }

      body {
        font-family: "Nunito", sans-serif;
        width: 100%;
        height: 100vh;
        background-color: #232626;
        color: #f5f5f5;
      }

      .title {
        display: block;
        width: 100%;
        padding: 1.5rem;
        font-size: 3.5rem;
        text-align: center;
      }

      .form {
        margin: 7rem auto 1.5rem auto;
      }

      .form .form-element {
        width: 40rem;
        margin: 1rem auto;
      }

      .form .form-element label {
        display: block;
        font-size: 2rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 0.5rem;
      }

      .form .form-element input {
        padding: 1rem;
        outline: none;
        border: none;
        font-size: 1.6rem;
        font-weight: 600;
        font-family: "Nunito", sans-serif;
        width: 100%;
        height: 45px;
      }

      .form .form-element button {
        width: 100%;
        height: 45px;
        background: #2962ff;
        color: #f5f5f5;
        border: none;
        outline: none;
        font-family: "Nunito", sans-serif;
        font-weight: bold;
        font-size: 1.6rem;
        cursor: pointer;
      }

      .video-data {
        width: 40rem;
        margin: 0 auto;
        display: none;
      }

      .video-data .data .thumbnail img {
        width: 100%;
        display: block;
        margin: 0 auto;
      }

      .video-data .data .info h2 {
        font-size: 1.8rem;
        margin: 1rem auto;
        color: #f5f5f5;
      }

      .video-data .controls {
        display: flex;
        justify-content: space-between;
      }

      .video-data .controls select,
      .video-data .controls button {
        width: 48%;
        height: 4rem;
        outline: none;
      }

      .video-data .controls button {
        border: none;
        font-family: "Nunito", sans-serif;
        font-size: 1.7rem;
        font-weight: bold;
        color: #f5f5f5;
        background-color: #2962ff;
        cursor: pointer;
      }

      .error-message {
        color: #cc0000;
        font-family: "Nunito", sans-serif;
        font-size: 1.8rem;
        font-weight: 600;
        text-align: center;
        opacity: 0;
        transition: all 0.4s;
      }
    </style>
  </head>

  <body>
    <h1 class="title">youtube video downloader</h1>

    <div class="form">
      <div class="form-element">
        <label for="videoURL">Enter youtube video link</label>
        <input type="text" id="videoURL" />
      </div>

      <div class="form-element">
        <button id="getVideo">Find video</button>
      </div>
    </div>

    <p class="error-message"></p>

    <div class="video-data">
      <div class="data">
        <div class="thumbnail">
          <img src="" alt="" />
        </div>
        <div class="info">
          <h2></h2>
          <p></p>
        </div>
      </div>
      <div class="controls">
        <input type="hidden" id="video-url" />
        <select id="download-options"></select>
        <button id="download-btn">Download</button>
      </div>
    </div>
  </body>
  <script>
    const HOST = "http://localhost:5000/";

    const thumbnail = document.querySelector(".video-data .thumbnail img");
    const title = document.querySelector(".video-data .info h2");
    const videoURL = document.querySelector("#video-url");
    const downloadOptions = document.querySelector("#download-options");

    const videoData = document.querySelector(".video-data");

    const getVideoButton = document.querySelector("#getVideo");

    const errorMessage = document.querySelector(".error-message");

    const fetchData = async (videoURL) => {
      try {
        const response = await fetch(`${HOST}videoInfo?videoURL=${videoURL}`);
        const data = await response.json();

        let detailsNodes = {
          thumbnail,
          title,
          videoURL,
          downloadOptions,
        };

        let optionsHTML = "";

        for (let i = 0; i < data.formats.length; i++) {
          if (data.formats[i].container != "mp4") {
            continue;
          }
          optionsHTML += `
                <option value="${data.formats[i].itag}">
                  ${data.formats[i].container} - ${data.formats[i].qualityLabel}
                  </option>
                  `;
          detailsNodes.thumbnail.src =
            data.videoDetails.thumbnails[
              data.videoDetails.thumbnails.length - 1
            ].url; // get HD thumbnail img
          detailsNodes.title.innerHTML = data.videoDetails.title;
          detailsNodes.videoURL.value = videoURL;
          detailsNodes.downloadOptions.innerHTML = optionsHTML;

          videoData.style.display = "block";
          videoData.scrollIntoView({
            behavior: "smooth",
          });
        }
      } catch (err) {
        console.error(err.message);
      }
    };

    getVideoButton.addEventListener("click", () => {
      const videoURL = document.querySelector("#videoURL").value.trim();

      if (videoURL.length == 0) {
        errorMessage.textContent = "Insert the link";
        errorMessage.style.opacity = 1;

        setTimeout(() => {
          errorMessage.style.opacity = 0;
        }, 1200);

        return;
      }

      fetchData(videoURL);
    });

    const downloadBtn = document.getElementById("download-btn");

    downloadBtn.addEventListener("click", () => {
      const videoURL = document.querySelector("#video-url").value;
      const itag = document.querySelector("#download-options").value;
      window.open(`${HOST}download?videoURL=${videoURL}&itag=${itag}`);
    });
  </script>
</html>
